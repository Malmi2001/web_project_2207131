{"version":3,"file":"react.js","sources":["../src/react.tsx"],"sourcesContent":["import React, { useEffect, useCallback, useState } from \"react\"\nimport ReactDOM from \"react-dom\"\nimport styles from \"./styles/embed.module.css\"\nimport { LaunchProps } from \"./types\"\n\ninterface PayHereReactProps extends LaunchProps {\n  open: boolean\n  selector: string\n  disableCustomer?: \"yes\" | \"no\"\n  hideAmount?: \"yes\" | \"no\"\n}\n\nconst PayhereEmbed: React.FC<PayHereReactProps> = ({\n  open,\n  selector,\n  embedURL,\n  customerName,\n  customerEmail,\n  disableCustomer,\n  amountInCents,\n  hideAmount,\n  customFields,\n  onSuccess,\n  onFailure,\n  onClose,\n}) => {\n  const [isLoading, setLoading] = useState(true)\n\n  // Don't load in non browser context\n  if (typeof window === \"undefined\") return null\n\n  const origin = window.location.origin\n  const customFieldsStr = customFields ? btoa(JSON.stringify(customFields)) : \"\"\n  customerEmail = customerEmail ? encodeURIComponent(customerEmail) : \"\"\n\n  const onMessage = useCallback(\n    (e) => {\n      switch (e.data.message) {\n        case \"payhere:ready\":\n          setLoading(false)\n          break\n        case \"payhere:success\":\n          const data = e.data.content\n          onSuccess(data)\n          if (\n            data.plan &&\n            data.plan.success_url &&\n            data.plan.success_url.length > 0\n          ) {\n            console.log(\"Redirecting to \" + data.plan.success_url)\n            setTimeout(() => {\n              window.location.href = data.plan.success_url\n            }, 2000)\n          }\n          break\n        case \"payhere:failure\":\n          onFailure(e.data.content)\n          break\n        case \"payhere:close\":\n          onClose()\n          setLoading(true)\n          break\n      }\n    },\n    [onSuccess, onFailure, onClose]\n  )\n\n  useEffect(() => {\n    window.addEventListener(\"message\", onMessage, false)\n    return () => window.removeEventListener(\"message\", onMessage, false)\n  })\n\n  if (!open) return null\n\n  const element = document.querySelector<HTMLElement>(selector)\n\n  if (!element) {\n    console.error(\n      `Payhere embed SDK: Element not found with selector '${selector}'`\n    )\n    return null\n  }\n\n  return ReactDOM.createPortal(\n    <div className={styles.embedContainer}>\n      {isLoading && (\n        <div className={styles.ldsRing}>\n          <div></div>\n          <div></div>\n          <div></div>\n          <div></div>\n        </div>\n      )}\n      <div\n        className={styles.embedModal}\n        style={{ transform: isLoading ? `scale(0)` : `scale(1)` }}\n      >\n        <iframe\n          className={styles.embedIframe}\n          src={`${embedURL}?embedded=yes&embed_origin=${origin}&customer_name=${\n            customerName || \"\"\n          }&customer_email=${customerEmail || \"\"}&disable_customer_fields=${\n            disableCustomer || \"no\"\n          }&hide_amount=${hideAmount || \"no\"}&amount_in_cents=${\n            amountInCents || \"\"\n          }&custom_fields=${customFieldsStr}`}\n        ></iframe>\n      </div>\n    </div>,\n    element\n  )\n}\n\nexport default PayhereEmbed\n"],"names":["useState","useCallback","useEffect","ReactDOM","React"],"mappings":"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"}